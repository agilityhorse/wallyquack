<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="A fun free-to-play arcade game. Test yourself in the wallhack test."
    />
    <title>Wally Quack - Small Arcade Game</title>

    <!-- optional analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V917VZVWFL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag("js", new Date());
      gtag("config", "G-V917VZVWFL");
    </script>

    <style>
      :root {
        --bg: #1a1a1a;
        --accent: #00aaff;
        --text: #ffffff;
        --game-bg: #000000;
        --vh: 1vh; /* zostanie ustawione dynamicznie w JS */
      }

      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: Arial, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* gÅ‚Ã³wny wrapper strony */
      .page {
        width: 100%;
        max-width: 1200px;
        height: calc(var(--vh, 1vh) * 100); /* dynamic fix dla mobile */
        box-sizing: border-box;
        padding: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
      }

      /* przycisk Start */
      .controls {
        width: 100%;
        display: flex;
        justify-content: center;
        flex-shrink: 0;
        z-index: 20;
      }

      .start-button {
        font-size: 1rem;
        padding: 10px 18px;
        background: var(--accent);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }

      main {
        width: 100%;
        flex: 1 1 auto;
        min-height: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .game-container {
        width: 100%;
        height: 100%;
        display: none;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        overflow: hidden;
      }

      .game-inner {
        height: 100%;
        aspect-ratio: 1 / 2;
        max-width: 100%;
        max-height: 100%;
        position: relative;
        background: var(--game-bg);
        border-radius: 10px;
      }

      .game-inner iframe {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
      }

      footer.game-footer {
        font-size: 0.9rem;
        text-align: center;
        color: var(--text);
        padding: 6px 10px calc(env(safe-area-inset-bottom, 10px) + 6px);
        flex-shrink: 0;
      }

      footer.game-footer a {
        color: var(--accent);
        text-decoration: none;
      }

      /* ðŸ“± mobile */
      @media (max-width: 900px) {
        .page {
          padding: 6px 8px 10px;
        }

        .start-button {
          padding: 12px 22px;
          font-size: 1.05rem;
        }

        .game-inner {
          aspect-ratio: 9 / 16; /* lepsze dopasowanie pionowe */
          width: 100%;
          height: auto;
          max-height: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div class="page">
      <div class="controls">
        <button id="startBtn" class="start-button">Start Game</button>
      </div>

      <main>
        <div id="desktopGame" class="game-container desktop" aria-hidden="true">
          <div class="game-inner">
            <iframe
              id="desktopIframe"
              src="./game-desktop.html"
              sandbox="allow-scripts allow-same-origin"
              title="Wally Quack (desktop)"
            ></iframe>
          </div>
        </div>

        <div id="mobileGame" class="game-container mobile" aria-hidden="true">
          <div class="game-inner">
            <iframe
              id="mobileIframe"
              src="./mobile/game.html"
              allowfullscreen
              title="Wally Quack (mobile)"
            ></iframe>
          </div>
        </div>
      </main>

      <footer class="game-footer">
        I hope, You will hate my game. Created by
        <a href="https://x.com/AgilityHorse" target="_blank" rel="noopener noreferrer">@AgilityHorse</a>
      </footer>
    </div>

    <!-- âœ… dynamiczny fix dla wysokoÅ›ci viewportu na mobilnych -->
    <script>
      function setVh() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }
      setVh();
      window.addEventListener('resize', setVh);
      window.addEventListener('orientationchange', setVh);
    </script>

    <!-- ðŸŽ® gÅ‚Ã³wny skrypt gry -->
    <script>
      (function () {
        const startBtn = document.getElementById("startBtn");
        const desktopGame = document.getElementById("desktopGame");
        const mobileGame = document.getElementById("mobileGame");

        function isMobileLike() {
          return window.innerWidth <= 900;
        }

        startBtn.addEventListener("click", async () => {
          // ðŸ“Š Zlicz klikniÄ™cie w GA4
          gtag('event', 'start_game_click', {
            event_category: 'Game',
            event_label: 'Start Button',
            value: 1
          });

          startBtn.style.display = "none";

          if (isMobileLike()) {
            mobileGame.style.display = "flex";
            mobileGame.setAttribute("aria-hidden", "false");

            try {
              if (mobileGame.requestFullscreen) {
                await mobileGame.requestFullscreen();
              } else if (mobileGame.webkitRequestFullscreen) {
                await mobileGame.webkitRequestFullscreen();
              } else if (mobileGame.msRequestFullscreen) {
                await mobileGame.msRequestFullscreen();
              }
            } catch (e) {
              console.warn("Fullscreen request failed or denied:", e);
            }
          } else {
            desktopGame.style.display = "flex";
            desktopGame.setAttribute("aria-hidden", "false");
          }
        });

        document.addEventListener("fullscreenchange", () => {
          if (!document.fullscreenElement) {
            startBtn.style.display = "";
            mobileGame.style.display = "none";
            mobileGame.setAttribute("aria-hidden", "true");
          }
        });
      })();
    </script>
  </body>
</html>
